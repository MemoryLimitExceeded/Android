### 概览

​	UI 界面在开发中是极其重要的一部分，几乎所有的 UI 界面都是用 View 来描述的。作为 UI 的描述，就少不了与用户交互的逻辑和动画，而这些就需要使用 View 来实现。一般情况下是从 xml 中添加 View，不过也可以从代码中添加，但要比 xml 麻烦些，不过灵活性就大大增加了。

> ※ 实际上 View 需要一个容器才能显示到屏幕上，这个容器就是 [Window](https://github.com/MemoryLimitExceeded/Android/blob/master/%E7%9F%A5%E8%AF%86%E7%82%B9/readme%E8%AF%A6%E7%BB%86%E5%86%85%E5%AE%B9/Android/UI/Window/%E6%A6%82%E8%A7%88.md)，下面的内容多少会涉及到 Window ，不过不需要事先学习就可以阅读，有兴趣的可以先去看 Window，更方便理解

#### 目录

- View 树
  - View、ViewGroup 和 ViewParent
  - ViewRootImpl
  - 创建过程
  - 遍历时机
  - 遍历流程
- View 的事件分发
  - 测量
  - 定位
  - 绘制
- View 动画

***

- View 树

  在 xml 写布局的时候，里面的元素都形成了树状结构的关系。对于一个界面就是一颗 View 树，我们在使用 findViewById() 时，就是深度优先遍历去找 View 的实例。
  
  - View、ViewGroup 和 ViewParent
  
    先以一个 UML 图介绍它们之间的联系：
  
    ![](http://chuantu.xyz/t6/714/1580691912x989559058.jpg)
  
    ViewGroup 为 View 的子类，且实现了 ViewParent。以 UML 图的视角来看是这么回事。如果从 xml 来看 ViewGroup 是 View 的父布局，ViewGroup 也可以是 ViewGroup 的父布局。
  
    ![View 树](https://developer.android.google.cn/images/viewgroup_2x.png)
  
    结合上面所述，在布局中，View 树的叶子结点一定是 View 类或其子类 ViewGroup（因为 ViewGroup 也算是 View），其余都是 ViewGroup。ViewParent 的作用是提供了子布局的 View 或其子类 ViewGroup 与父布局交互的接口。
  
    ```Java
    //--- SDK 29 ---
    @UnsupportedAppUsage(maxTargetSdk = Build.VERSION_CODES.P)
    protected ViewParent mParent;
    ```
  
  - ViewRootImpl
  
  - 创建过程
  
    - View 树在 Activity 中的创建过程
  
      View 树的创建是由 Activity 的 onCreate() 中的 setContentView() 发起的。
  
      > ※ 如果不清楚 Activity 的 onCreate() 是什么的话请参阅 Activity [概览](https://github.com/MemoryLimitExceeded/Android/blob/master/%E7%9F%A5%E8%AF%86%E7%82%B9/readme%E8%AF%A6%E7%BB%86%E5%86%85%E5%AE%B9/Android/%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/Activity/%E6%A6%82%E8%A7%88.md)的生命周期那一节
  
      由于 View 需要 Window 作为载体，Activity 在创建出实例的时候紧接着就拿到属于自己的 Window 实例，每一个 Activity 对应一个 Window。然后 Activity 调用 getWindow().setContentView(Int) 在 Window 生成一个叫 DecorView 的实例，做为 View 树的根 View，它继承于  FrameLayout，而 FrameLayout 又继承于 ViewGroup，这样 Window 就持有这一个实例。
  
      ![](https://upload-images.jianshu.io/upload_images/7522223-68eef8da18fe8dce.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)
  
      > ※ Window 是抽象类，只有 PhoneWindow 实现了它。上图中的 Action Bar 在 Android 5.0 的时候被替换成了 Tool Bar，默认用 TextView 作为标题显示
  
      一般界面还包含状态栏（Status Bar），状态栏和标题都是能隐藏的，至于怎么隐藏这里就不叙述了。
  
      ![](http://chuantu.xyz/t6/714/1580746338x989559058.png)
  
      在 Activity.setContentView(Int) 传入的布局文件 Id ，解析 xml 并将这个布局添加到内容（content）。
  
    - View 树在 dialog 中的创建过程
  
    - 在 View 树中添加和删除 View
  
  - 遍历时机
  
    
  
    